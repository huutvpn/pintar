<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kuis PAI SD Kelas 3 & 4</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --primary:#2E8B57; --light:#F0FFF0; --danger:#e74c3c; --white:#fff;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:var(--light);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
.app{background:var(--white);width:100%;max-width:650px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,.2);overflow:hidden;}
header{background:var(--primary);color:#fff;padding:20px;text-align:center;}
.screen{display:none;padding:25px;min-height:400px;}
.screen.active{display:block;}
.form-group{margin-bottom:15px;}
label{font-weight:bold;margin-bottom:5px;display:block;color:var(--primary);}
input,select{width:100%;padding:10px;border:2px solid #ccc;border-radius:8px;}
.btn{width:100%;padding:12px;font-weight:bold;color:#fff;background:var(--primary);border:none;border-radius:8px;margin-top:10px;cursor:pointer;}
.btn-danger{background:var(--danger);}
.question-card{background:#fafafa;padding:18px;border-left:5px solid gold;margin-bottom:15px;border-radius:10px;}
.option{border:2px solid #ccc;padding:12px;border-radius:8px;margin:8px 0;cursor:pointer;}
.option.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
.score-circle{width:140px;height:140px;border-radius:50%;background:var(--primary);color:#fff;display:flex;justify-content:center;align-items:center;font-size:2.5rem;margin:15px auto;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ddd;padding:7px;font-size:.85rem;}
th{background:var(--primary);color:#fff;}
small{color:red;}
.link{margin-top:10px;text-align:center;font-size:.8rem;}
.link a{color:#555;text-decoration:none;}
</style>
</head>

<body>
<div class="app">
<header>
    <h2>Kuis PAI SD</h2>
    <p>Kelas 3A, 3B, 4A, 4B</p>
</header>

<!-- LOGIN -->
<div id="login" class="screen active">
    <h3 style="text-align:center;margin-bottom:10px;">Masukkan Data</h3>
    <div class="form-group">
        <label>Nama Siswa</label>
        <input id="studentName" type="text">
    </div>
    <div class="form-group">
        <label>Kelas</label>
        <select id="studentClass">
            <option value="" disabled selected>Pilih Kelas</option>
            <option value="3A">Kelas 3A</option>
            <option value="3B">Kelas 3B</option>
            <option value="4A">Kelas 4A</option>
            <option value="4B">Kelas 4B</option>
        </select>
    </div>
    <small id="loginError" style="display:none;"></small>
    <button class="btn" onclick="startQuiz()">Mulai Kuis</button>
    <div class="link"><a href="#" onclick="openAdmin()">Masuk Guru/Admin</a></div>
</div>

<!-- QUIZ -->
<div id="quiz" class="screen">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span id="progress">Soal 1/10</span>
        <span id="kelasTag" style="font-weight:bold;color:var(--primary);"></span>
    </div>
    <div class="question-card">
        <div id="questionText"></div>
    </div>
    <div id="options"></div>
    <button id="nextBtn" class="btn" onclick="nextQuestion()" disabled>Selanjutnya</button>
</div>

<!-- RESULT -->
<div id="result" class="screen">
    <h3 style="text-align:center;">Kuis Selesai!</h3>
    <h4 id="nameResult" style="text-align:center;"></h4>
    <div id="scoreBox" class="score-circle"></div>
    <p style="text-align:center;">Nilai sudah direkap</p>
    <button class="btn" onclick="restart()">Kembali ke Awal</button>
</div>

<!-- ADMIN -->
<div id="admin" class="screen">
    <h3 style="text-align:center;">REKAP NILAI</h3>
    <div style="overflow-x:auto;">
        <table id="scoreTable">
            <thead><tr><th>No</th><th>Nama</th><th>Kelas</th><th>Nilai</th><th>Waktu</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
    <button class="btn-danger btn" onclick="resetData()">Reset Semua Data</button>
    <button class="btn" onclick="goLogin()">Kembali</button>
</div>

<script>
/* ====================== DATA SOAL ====================== */
const pool3=[
{q:"Berapa jumlah rukun Islam?",opts:["4","5","6","7"],a:1},
{q:"Rukun Islam pertama adalah?",opts:["Shalat","Zakat","Puasa","Syahadat"],a:3},
{q:"Shalat wajib berjumlah?",opts:["3","4","5","6"],a:2},
{q:"Siapa nabi terakhir?",opts:["Musa","Isa","Ibrahim","Muhammad SAW"],a:3},
{q:"Kitab suci umat Islam adalah?",opts:["Zabur","Taurat","Injil","Al-Qur'an"],a:3},
{q:"Malaikat pencatat amal baik?",opts:["Jibril","Mikail","Raqib","Atid"],a:2},
{q:"Surat artinya demi waktu?",opts:["Al-Fatihah","Al-Ikhlas","Al-Asr","An-Nas"],a:2},
{q:"Malaikat meniup sangkakala?",opts:["Israfil","Izrail","Munkar","Nakir"],a:0},
{q:"Manusia pertama?",opts:["Musa","Adam","Ibrahim","Nuh"],a:1},
{q:"Puasa wajib berniat?",opts:["Siang","Tengah malam","Sebelum subuh","Setelah subuh"],a:2}
];

const pool4=[ /* 30 soal baligh ringkas */
{q:"Perubahan menuju dewasa disebut?",opts:["Baligh","Tua","Bayi","Hamil"],a:0},
{q:"Baligh artinya mulai?",opts:["Wajib ibadah","Boleh malas","Tidur","Main"],a:0},
{q:"Tanda baligh laki-laki?",opts:["Menstruasi","Suara berat","Hamil","Menopause"],a:1},
{q:"Tanda baligh perempuan?",opts:["Mimpi basah","Menstruasi","Kumis","Suara pecah"],a:1},
{q:"Menstruasi adalah tanda?",opts:["Laki-laki","Perempuan","Bayi","Tua"],a:1},
{q:"Mimpi basah tanda?",opts:["Laki-laki","Perempuan","Bayi","Tua"],a:0},
{q:"Usia baligh biasanya?",opts:["1-3","5-7","9-15","20-30"],a:2},
{q:"Amal dicatat saat?",opts:["Baligh","TK","SD","Bayi"],a:0},
{q:"Aurat laki-laki?",opts:["Rambut","Pusar-lutut","Dada","Leher"],a:1},
{q:"Aurat perempuan?",opts:["Paha","Seluruh tubuh kecuali wajah & telapak tangan","Kaki","Rambut"],a:1},
{q:"Perempuan baligh wajib?",opts:["Berhijab","Tidak sekolah","Menangis","Main"],a:0},
{q:"Laki-laki baligh wajib?",opts:["Sholat","Tidur","Main","Minum"],a:0},
{q:"Fisik laki-laki berubah?",opts:["Tumbuh kumis","Menstruasi","Tidak","Hamil"],a:0},
{q:"Fisik perempuan berubah?",opts:["Payudara tumbuh","Suara berat","Kumis","Tidak"],a:0},
{q:"Harus menjaga kebersihan?",opts:["Baju & tubuh","Buku","Motor","Kipas"],a:0},
{q:"Mandi wajib setelah?",opts:["Makan","Mimpi basah","Tidur","Belanja"],a:1},
{q:"Menstruasi setiap?",opts:["1 tahun","1 bulan","10 tahun","1 minggu"],a:1},
{q:"Baligh tanda mulai?",opts:["Tanggung jawab agama","Main","Tidur","Malas"],a:0},
{q:"Menutup aurat hukumnya?",opts:["Wajib","Sunnah","Makruh","Haram"],a:0},
{q:"Jaga pandangan agar?",opts:["Tidak ganggu","Main","Makan","Tidur"],a:0},
{q:"Bukan tanda baligh?",opts:["Suara pecah","Menstruasi","Mimpi basah","Bermain"],a:3},
{q:"Baligh ditandai keluar?",opts:["Haid/Mani","Air liur","Keringat","Air mata"],a:0},
{q:"Akhlak baik adalah?",opts:["Berkata baik","Jorok","Bohong","Membully"],a:0},
{q:"Sholat wajib bagi?",opts:["Baligh","TK","SD","Bayi"],a:0},
{q:"Perempuan haid tidak boleh?",opts:["Sholat","Minum","Bicara","Mandi"],a:0},
{q:"Setelah haid wajib?",opts:["Mandi wajib","Marah","Main","Tidur"],a:0},
{q:"Berbakti pada orang tua hukumnya?",opts:["Wajib","Makruh","Sunnah","Haram"],a:0},
{q:"Akhlak baligh adalah?",opts:["Jaga lisan","Bohong","Marah","Membully"],a:0},
{q:"Tidak boleh buka aurat depan?",opts:["Non mahram","Ibu","Ayah","Dokter"],a:0},
{q:"Baligh berarti boleh?",opts:["Tanggung jawab agama","Jadi bayi","Tanpa tugas","Tidur"],a:0}
];

/* ============= STATE ============= */
let current=[],index=0,score=0,student="",kelas="";
const synth=window.speechSynthesis;

/* ========== FUNCTIONS ========== */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function startQuiz(){
    const n=document.getElementById("studentName").value.trim();
    const k=document.getElementById("studentClass").value;
    const err=document.getElementById("loginError");
    if(!n||!k){err.innerText="Harap isi nama & kelas";err.style.display="block";return;}

    // CEK SUDAH PERNAH MENGERJAKAN
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    if(history.some(x=>x.name==n && x.class==k)){
        err.innerText="Siswa ini sudah mengerjakan!";
        err.style.display="block";
        return;
    }

    student=n; kelas=k; err.style.display="none";
    const pool=(k=="3A"||k=="3B")?pool3:pool4;
    current=shuffle([...pool]).slice(0,10);
    index=0; score=0;

    document.getElementById("kelasTag").innerText="Kelas "+k;
    showQuestion();
    showScreen("quiz");
}

function showQuestion(){
    const q=current[index];
    document.getElementById("progress").innerText=`Soal ${index+1}/10`;
    document.getElementById("questionText").innerText=q.q;

    // Baca suara otomatis
    speak(q.q);

    const opt=document.getElementById("options");
    opt.innerHTML="";
    document.getElementById("nextBtn").disabled=true;

    q.opts.forEach((o,i)=>{
        const div=document.createElement("div");
        div.className="option";
        div.innerText=o;
        div.onclick=()=>select(i,div);
        opt.appendChild(div);
    });
}

function select(i,el){
    document.querySelectorAll(".option").forEach(e=>e.classList.remove("selected"));
    el.classList.add("selected");
    el.setAttribute("data-choice",i);
    document.getElementById("nextBtn").disabled=false;
}

function nextQuestion(){
    const choice=document.querySelector(".option.selected").getAttribute("data-choice");
    if(choice==current[index].a)score+=10;
    index++;
    if(index<current.length)showQuestion();
    else finish();
}

function finish(){
    document.getElementById("nameResult").innerText=student;
    document.getElementById("scoreBox").innerText=score;

    // SIMPAN NILAI
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    history.push({name:student,class:kelas,score:score,time:new Date().toLocaleString("id")});
    localStorage.setItem("quizHistory",JSON.stringify(history));

    showScreen("result");
}

function speak(text){
    synth.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang="id-ID"; u.rate=0.9;
    synth.speak(u);
}

function restart(){location.reload();}

function openAdmin(){
    const pwd=prompt("Masukkan sandi guru:");
    if(pwd==="040698"){loadTable();showScreen("admin");}
    else if(pwd!==null)alert("Sandi salah!");
}

function loadTable(){
    const body=document.querySelector("#scoreTable tbody");
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    body.innerHTML="";
    history.forEach((x,i)=>{
        body.innerHTML+=`<tr><td>${i+1}</td><td>${x.name}</td><td>${x.class}</td><td>${x.score}</td><td>${x.time}</td></tr>`;
    });
}

function resetData(){
    if(confirm("Yakin reset semua data?")){
        localStorage.removeItem("quizHistory");
        loadTable();
        alert("Data terhapus!");
    }
}

function goLogin(){
    showScreen("login");
}

function showScreen(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}
</script>

</div>
</body>
</html>
