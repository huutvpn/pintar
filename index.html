<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kuis PAI SD Kelas 3 & 4</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root { --primary:#2E8B57; --light:#F0FFF0; --danger:#e74c3c; --white:#fff;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:var(--light);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
.app{background:var(--white);width:100%;max-width:650px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,.2);overflow:hidden;}
header{background:var(--primary);color:#fff;padding:20px;text-align:center;}
.screen{display:none;padding:25px;min-height:400px;}
.screen.active{display:block;}
.form-group{margin-bottom:15px;}
label{font-weight:bold;margin-bottom:5px;display:block;color:var(--primary);}
input,select{width:100%;padding:10px;border:2px solid #ccc;border-radius:8px;}
.btn{width:100%;padding:12px;font-weight:bold;color:#fff;background:var(--primary);border:none;border-radius:8px;margin-top:10px;cursor:pointer;}
.btn-danger{background:var(--danger);}
.question-card{background:#fafafa;padding:18px;border-left:5px solid gold;margin-bottom:15px;border-radius:10px;}
.option{border:2px solid #ccc;padding:12px;border-radius:8px;margin:8px 0;cursor:pointer;}
.option.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
.score-circle{width:140px;height:140px;border-radius:50%;background:var(--primary);color:#fff;display:flex;justify-content:center;align-items:center;font-size:2.5rem;margin:15px auto;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ddd;padding:7px;font-size:.85rem;}
th{background:var(--primary);color:#fff;}
.link{text-align:center;margin-top:10px;font-size:.8rem;}
.link a{color:#555;text-decoration:none;}
small{color:red;}
</style>
</head>

<body>
<div class="app">
<header>
    <h2>Kuis PAI SD</h2>
    <p>Kelas 3A, 3B, 4A, 4B</p>
</header>

<!-- LOGIN -->
<div id="login" class="screen active">
    <h3 style="text-align:center;margin-bottom:10px;">Masukkan Data</h3>
    <div class="form-group">
        <label>Nama Siswa</label>
        <input id="studentName" type="text">
    </div>
    <div class="form-group">
        <label>Kelas</label>
        <select id="studentClass">
            <option value="" disabled selected>Pilih Kelas</option>
            <option value="3A">Kelas 3A</option>
            <option value="3B">Kelas 3B</option>
            <option value="4A">Kelas 4A</option>
            <option value="4B">Kelas 4B</option>
        </select>
    </div>
    <small id="loginError" style="display:none;"></small>
    <button class="btn" onclick="startQuiz()">Mulai Kuis</button>
    <div class="link"><a href="#" onclick="openAdmin()">Masuk Guru/Admin</a></div>
</div>

<!-- QUIZ -->
<div id="quiz" class="screen">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span id="progress">Soal 1/10</span>
        <span id="kelasTag" style="font-weight:bold;color:var(--primary);"></span>
    </div>
    <div class="question-card"><div id="questionText"></div></div>
    <div id="options"></div>
    <button id="nextBtn" class="btn" onclick="nextQuestion()" disabled>Selanjutnya</button>
</div>

<!-- RESULT -->
<div id="result" class="screen">
    <h3 style="text-align:center;">Kuis Selesai!</h3>
    <h4 id="nameResult" style="text-align:center;"></h4>
    <div id="scoreBox" class="score-circle"></div>
    <p style="text-align:center;">Nilai sudah direkap</p>
    <button class="btn" onclick="restart()">Kembali ke Awal</button>
</div>

<!-- ADMIN -->
<div id="admin" class="screen">
    <h3 style="text-align:center;">REKAP NILAI</h3>
    <div id="rekapWrapper" style="max-height:500px; overflow-y:auto; padding-right:5px;"></div>
    <button class="btn-danger btn" onclick="resetData()">Reset Semua Data</button>
    <button class="btn" onclick="goLogin()">Kembali</button>
</div>

<script>
/* ====================== SOAL KELAS 3 ====================== */
const pool3 = [
{q:"Bulan yang sangat ditunggu umat Islam adalah bulan?", opts:["Syawal","Ramadhan","Muharram","Dzulhijjah"], a:1},
{q:"Puasa Ramadhan hukumnya adalah?", opts:["Sunnah","Makruh","Mubah","Wajib"], a:3},
{q:"Puasa Ramadhan dimulai sejak?", opts:["Terbit matahari","Terbenam matahari","Masuk subuh","Masuk maghrib"], a:2},
{q:"Puasa Ramadhan berakhir saat?", opts:["Subuh","Dzuhur","Ashar","Maghrib"], a:3},
{q:"Niat puasa Ramadhan dilakukan pada?", opts:["Siang","Sore","Malam hari","Pagi"], a:2},
{q:"Shalat sunnah di malam Ramadhan adalah shalat?", opts:["Tahajud","Tarawih","Dhuha","Idul Fitri"], a:1},
{q:"Waktu shalat Tarawih adalah saat?", opts:["Pagi","Siang","Malam","Subuh"], a:2},
{q:"Orang yang tidak kuat berpuasa karena sakit boleh?", opts:["Tetap puasa","Tidak makan","Buka puasa","Tidur saja"], a:2},
{q:"Anak kecil yang belum baligh boleh?", opts:["Tidak puasa","Diusir","Dimarahi","Tidak boleh makan"], a:0},
{q:"Bulan Ramadhan adalah bulan penuh?", opts:["Musibah","Berkah","Kemarau","Kesedihan"], a:1},
{q:"Malam yang lebih baik dari seribu bulan adalah malam?", opts:["Idul Fitri","Jumat","Lailatul Qadar","Tahun baru"], a:2},
{q:"Hari raya setelah Ramadhan adalah?", opts:["Idul Adha","Idul Fitri","Maulid Nabi","Tahun Baru"], a:1},
{q:"Membayar zakat fitrah dilakukan pada?", opts:["Awal tahun","Akhir Ramadhan","Bulan Muharram","Bulan Syawal"], a:1},
{q:"Zakat fitrah diberikan kepada?", opts:["Guru","Orang kaya","Orang miskin","Semua orang"], a:2},
{q:"Berbuka puasa disunnahkan dengan?", opts:["Es krim","Air putih dan kurma","Nasi","Kue"], a:1},
{q:"Doa berbuka puasa diawali dengan kalimat?", opts:["Bismillah","Allahumma","Alhamdulillah","Astaghfirullah"], a:1},
{q:"Puasa berarti menahan diri dari?", opts:["Makan dan minum","Belajar","Tidur","Bermain"], a:0},
{q:"Umat Islam menyambut Ramadhan dengan hati?", opts:["Sedih","Marah","Gembira","Benci"], a:2},
{q:"Ibadah yang sering dilakukan saat Ramadhan adalah?", opts:["Jajan","Tadarus Al-Qur'an","Tidur","Bermain"], a:1},
{q:"Membaca Al-Qur'an disebut?", opts:["Berpuasa","Tadarus","Zikir","Sedekah"], a:1},
{q:"Selain puasa, umat Islam juga dianjurkan untuk?", opts:["Berkelahi","Sedekah","Mencuri","Berbohong"], a:1},
{q:"Orang yang berpuasa tidak boleh?", opts:["Berdoa","Makan di siang hari","Shalat","Belajar"], a:1},
{q:"Puasa Ramadhan adalah rukun Islam ke?", opts:["1","2","3","4"], a:2},
{q:"Jika melihat orang susah saat Ramadhan, kita harus?", opts:["Membantu","Menghina","Membiarkan","Menertawakan"], a:0},
{q:"Orang yang sedang bepergian jauh disebut?", opts:["Musafir","Petani","Nelayan","Pedagang"], a:0},
{q:"Musafir boleh tidak puasa dan harus?", opts:["Melupakan puasa","Mengqadha setelahnya","Tidak perlu ganti","Marah"], a:1},
{q:"Malam terakhir Ramadhan biasanya penuh dengan?", opts:["Permusuhan","Ibadah","Tidur","Keramaian"], a:1},
{q:"Idul Fitri artinya kembali ke?", opts:["Rumah","Sekolah","Fitri/suci","Pasar"], a:2},
{q:"Saat Idul Fitri kita saling?", opts:["Minta maaf","Bertengkar","Tidur","Menangis"], a:0},
{q:"Setelah shalat Idul Fitri biasanya kita?", opts:["Minta maaf kepada orang tua","Tidur","Ke pantai","Bermain game"], a:0}
];

/* ====================== SOAL KELAS 4 ====================== */
const pool4 = [
{q:"Perubahan dari anak-anak menuju dewasa disebut?", opts:["Balig","Hijrah","Tua","Berat"], a:0},
{q:"Anak laki-laki dianggap balig jika sudah mimpi?", opts:["Biasa","Basah","Buruk","Bahagia"], a:1},
{q:"Anak perempuan dianggap balig jika sudah?", opts:["Bermain","Haidh","Berkuda","Berdoa"], a:1},
{q:"Balig berarti sudah mulai?", opts:["Berhenti ibadah","Wajib ibadah","Nak nakal","Libur sekolah"], a:1},
{q:"Hijrah artinya berpindah dari?", opts:["Madinah ke Mekkah","Mekkah ke Madinah","Sekolah ke rumah","Rumah ke sekolah"], a:1},
{q:"Hijrah Nabi dilakukan bersama sahabat?", opts:["Umar","Bilal","Abu Bakar","Ali"], a:2},
{q:"Peristiwa hijrah terjadi pada bulan?", opts:["Rajab","Safar","Muharram","Syawal"], a:2},
{q:"Usia balig menandai anak sudah menjadi?", opts:["Bayi","Balita","Remaja","Kakek"], a:2},
{q:"Orang balig harus menjaga?", opts:["Makanan","Tidur","Aurah","Warna baju"], a:2},
{q:"Hijrah Nabi adalah perintah dari?", opts:["Raja","Nabi Isa","Allah SWT","Manusia"], a:2},
{q:"Kota tujuan hijrah Nabi adalah?", opts:["Damaskus","Baghdad","Madinah","Kairo"], a:2},
{q:"Nabi Muhammad hijrah dari kota?", opts:["Madinah","Mekkah","Thaif","Syam"], a:1},
{q:"Hijrah Nabi menandai permulaan?", opts:["Tahun Islam","Tahun masehi","Tahun cina","Tahun jawa"], a:0},
{q:"Orang balig harus mulai meninggalkan?", opts:["Kegiatan baik","Sikap buruk","Belajar","Ibadah"], a:1},
{q:"Hijrah Nabi dilakukan agar dakwah?", opts:["Terhambat","Mundur","Berkembang","Hilang"], a:2},
{q:"Perubahan fisik saat balig adalah?", opts:["Tinggi bertambah","Gigi hilang","Warna rambut","Mata berubah"], a:0},
{q:"Tanda balig pada laki-laki adalah?", opts:["Suara tambah berat","Bahasa berubah","Tinggi menurun","Tidur siang"], a:0},
{q:"Tanda balig pada perempuan adalah?", opts:["Suara pecah","Bersin banyak","Haidh","Hilang gigi"], a:2},
{q:"Anak balig wajib menjaga shalat?", opts:["Wajib","Tidak perlu","Kadang saja","Bebas"], a:0},
{q:"Saat hijrah, masyarakat Madinah menyambut Nabi dengan?", opts:["Marah","Permusuhan","Gembira","Sedih"], a:2},
{q:"Balig juga ditandai dengan perubahan?", opts:["Cuaca","Lingkungan","Emosi","Motor"], a:2},
{q:"Hijrah mengajarkan kita untuk tidak?", opts:["Sabar","Pantang menyerah","Takut berjuang","Berbuat salah"], a:3},
{q:"Nabi berlindung di gua?", opts:["Hira","Tsur","Uhud","Badar"], a:1},
{q:"Di Madinah Nabi membangun masjid?", opts:["Quba","Haram","Nabawi","Aqsa"], a:0},
{q:"Setelah balig harus mulai menjaga?", opts:["Jadwal kartun","Kebersihan diri","Game","Mainan"], a:1},
{q:"Hijrah secara maknawi berarti?", opts:["Berpindah fisik","Berubah lebih baik","Berdiam diri","Melamun"], a:1},
{q:"Anak balig harus menjauhi?", opts:["Sedekah","Kebaikan","Akhlaq buruk","Belajar"], a:2},
{q:"Hijrah Nabi dilakukan karena tekanan dari?", opts:["Orang Mekkah","Orang Madinah","Orang Mesir","Orang Syam"], a:0},
{q:"Tanggal hijrah Nabi menjadi awal sistem?", opts:["Sekolah","Kalender Hijriyah","Kalender Romawi","Kalender Jawa"], a:1},
{q:"Balig adalah tanda sudah mulai punya?", opts:["Tanggung jawab","Banyak mainan","Tidak belajar","Tidak shalat"], a:0}
];

/* ====================== STATE ====================== */
let current=[],index=0,score=0,student="",kelas="";
const synth=window.speechSynthesis;

/* ====================== FUNCTIONS ====================== */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function startQuiz(){
    const n=document.getElementById("studentName").value.trim();
    const k=document.getElementById("studentClass").value;
    const err=document.getElementById("loginError");

    if(!n||!k){err.innerText="Harap isi nama & kelas";err.style.display="block";return;}

    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    if(history.some(x=>x.name==n && x.class==k)){
        err.innerText="Siswa ini sudah mengerjakan!";
        err.style.display="block";
        return;
    }

    student=n; kelas=k;
    const pool=(k=="3A"||k=="3B")?pool3:pool4;
    current=shuffle([...pool]).slice(0,10);
    index=0; score=0;

    document.getElementById("kelasTag").innerText="Kelas "+k;
    showQuestion();
    showScreen("quiz");
}

function showQuestion(){
    const q=current[index];
    document.getElementById("progress").innerText=`Soal ${index+1}/10`;
    document.getElementById("questionText").innerText=q.q;
    speak(q.q);

    const opt=document.getElementById("options");
    opt.innerHTML="";
    document.getElementById("nextBtn").disabled=true;

    q.opts.forEach((o,i)=>{
        const div=document.createElement("div");
        div.className="option";
        div.innerText=o;
        div.onclick=()=>select(i,div);
        opt.appendChild(div);
    });
}

function select(i,el){
    document.querySelectorAll(".option").forEach(e=>e.classList.remove("selected"));
    el.classList.add("selected");
    el.setAttribute("data-choice",i);
    document.getElementById("nextBtn").disabled=false;
}

function nextQuestion(){
    const choice=document.querySelector(".option.selected").getAttribute("data-choice");
    if(choice==current[index].a)score+=10;
    index++;
    if(index<current.length)showQuestion();
    else finish();
}

function finish(){
    document.getElementById("nameResult").innerText=student;
    document.getElementById("scoreBox").innerText=score;
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    history.push({name:student,class:kelas,score:score,time:new Date().toLocaleString("id-ID")});
    localStorage.setItem("quizHistory",JSON.stringify(history));
    showScreen("result");
}

function speak(text){
    synth.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang="id-ID"; u.rate=0.9;
    synth.speak(u);
}

function restart(){location.reload();}

function openAdmin(){
    const pwd=prompt("Masukkan sandi guru:");
    if(pwd==="040698"){loadTable();showScreen("admin");}
    else if(pwd!==null)alert("Sandi salah!");
}

function loadTable(){
    const wrapper = document.getElementById("rekapWrapper");
    const history = JSON.parse(localStorage.getItem("quizHistory")||"[]");
    wrapper.innerHTML = "";

    const kelasList = ["3A","3B","4A","4B"];

    kelasList.forEach(kls=>{
        const dataKelas = history.filter(x=>x.class===kls);

        if(dataKelas.length === 0) return;

        wrapper.innerHTML += `<h3 style="margin-top:15px;color:var(--primary);font-size:1.1rem;">Kelas ${kls}</h3>`;

        let html = `
        <table>
            <thead>
                <tr>
                    <th>No</th>
                    <th>Nama</th>
                    <th>Nilai</th>
                    <th>Waktu</th>
                </tr>
            </thead>
            <tbody>
        `;

        dataKelas.forEach((x,i)=>{
            html += `
            <tr>
                <td>${i+1}</td>
                <td>${x.name}</td>
                <td>${x.score}</td>
                <td>${x.time}</td>
            </tr>`;
        });

        html += `</tbody></table>`;
        wrapper.innerHTML += html;
    });
}

function resetData(){
    if(confirm("Yakin reset semua data?")){
        localStorage.removeItem("quizHistory");
        loadTable();
        alert("Data terhapus!");
    }
}

function goLogin(){showScreen("login");}

function showScreen(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}
</script>

</div>
</body>
</html>
